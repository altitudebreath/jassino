"use strict";var Jassino=function(n){function t(n){if(i(n)){var r="";for(var e in n)r+=e+"::"+t(n[e])+"\n";return r}return String(n)}function r(n){console.log(n);var t="\n";for(var r in n)t+=r+": "+String(n[r])+"\n";return t}function e(n){function e(e,o,i){this.message=(n?n+": ":"\n")+(o||"DATA:")+" ==> \n"+t(e)+"\n"+(i?r(i):"")}return e.prototype=new Error,e.prototype.constructor=e,e}function o(n,t,r){return Array.prototype.slice.call(n,t,r)}function i(n){return"[object Object]"===Object.prototype.toString.call(n)&&n}function s(n){return"[object Array]"===Object.prototype.toString.call(n)}function a(n){return n?n.split(/\s*,\s*/):[]}function u(n,t,r){if(n===t)throw Error("Recursive assignment destination[fieldName] = destination! \n"+JSON.stringify(n)+"\n   fieldName: "+r);n[r]=t}function c(n,t){for(var r in t)if(t.hasOwnProperty(r)){var e=t[r];if(n===e)throw Error("Recursive assignment destination[fieldName] = destination! \n"+JSON.stringify(n)+"\n   fieldName: "+r);n[r]=e}return n}function f(n,t){for(var r=0;r<t.length;r++)c(n,t[r])}function l(t,r,e){var o=r[w],i=r[y],s=r[d];if(o){if(typeof e!==S)throw new n.MembersError(r,"Mixin cannot have class (static) members");p(e,o,e)}o&&delete r[w],i&&delete r[y],s&&delete r[d],p(t,r,e),o&&(r[w]=o),i&&(r[y]=i),s&&(r[d]=s)}function p(t,r,e){for(var o in r)if(r.hasOwnProperty(o)){var i,a=r[o],c=null,f=n.$$;s(a)?(i=a[a.length-1],c=a.slice(0,a.length-1)):i=a,c?(typeof i===S&&-1!==c.indexOf(f.cls)&&(i=f.cls(e,i)),-1!==c.indexOf(f.cached)&&(i=f.cached(i))):i=t===e&&typeof i===S?f.cls(e,i):i,u(t,i,o)}}function h(t){var r,e=n.ArgumentsError,o=0,a=t.length;if(2>a)throw new e(t,"Specify at least name and body");if(i(t[0]))o++,r=t[0];else{if(!t[0]||typeof t[0]!==C)throw new e(t,"First argument should be namespace or name");r=n.NS||null}var u={body:t[a-1],ns:r,name:t[o],sclass:null,smixins:null},c=a-(o+1)-1;if(!u.name||typeof u.name!==C)throw new e(u,"Invalid name");if(c>0){var f=" -> Parameters SHOULD BE: ([namespace,] name, [class,] [mixins_array,] body)",l=t[o+1];if(2==c){var p=t[o+2];if(typeof l!==S||!s(p))throw new e(u,"Super mixins and/or super class are invalid:"+l+","+p+f);u.sclass=l,u.smixins=p}else{if(1!=c)throw new e(u,"too many parameters");if(typeof l===S)u.sclass=l;else{if(!s(l))throw new e(u,"Class or mixins array is invalid: "+l+f);u.smixins=l}}}return u}function m(t,r){if(t.ns){if(typeof t.ns[t.name]!==x)throw new n.DuplicationError(t);t.ns[t.name]=r}}var y="_",d="__",w="cls",v="__name__",g="__child__",_="__super__",b="super",E="__jassino__";n.DuplicationError=e("Duplication"),n.ArgumentsError=e("Arguments"),n.ConstructorError=e("Constructor"),n.InstantiationError=e("Instantiation"),n.MembersError=e("Members"),n.useGlobalScope=function(t){var r=t||window;r.Class=n.Class,r.Mixin=n.Mixin,r.$$=n.$$,r.Jassino=n},n.setDefaultNS=function(n){return this.NS=n};var x="undefined",S="function",C="string";return n.Mixin=function(){var n=h(arguments),t={};if(m(n,t),n.smixins&&f(t,n.smixins),n.body[y])throw new AE(n,"Mixin should not contain the constructor!");return l(t,n.body),t},n.Class=function(){var t,r=h(arguments),e=r.body,i=r.sclass,s=e[y],u=e[d],p=function(){throw new n.InstantiationError({},'use "new": new ClassA()')};if(s&&"auto"!==s)if(typeof s===S)t=function(){this[E]||p();try{var t=o(arguments);t.unshift(i),s.apply(this,t)}catch(r){throw new n.ConstructorError(r.message,"\n[Hint1: Recursive call by constructor to itself ??]\n[Hint2: Need Super call ??]\n",r)}finally{}};else{if(typeof s!==C)throw new n.ConstructorError(s,"Invalid constructor");var w=a(s);if(u){if(!(u>0))throw new n.ConstructorError(u,"Invalid number of the Super constructor arguments");if(!i)throw new n.ConstructorError(s,"__: '"+u+"' assumes SuperClass presence");t=function(){this[E]||p(),i.apply(this,o(arguments,0,u));for(var n=u;n<w.length;n++)this[w[n]]=arguments[n]}}else{if(i&&typeof u===x)throw new n.ConstructorError(s,"_: '"+s+"' -- Class and SuperClass shortcut notations must be present both!");t=function(){this[E]||p();for(var n=0;n<w.length;n++)this[w[n]]=arguments[n]}}}else t=i?function(){this[E]||p(),i.apply(this,arguments)}:function(){this[E]||p()};if(m(r,t),i){i[v];t.prototype=Object.create(i.prototype),t.prototype.constructor=t,c(t,i),t.prototype[b]=function(n,t){return n[_].prototype[t].apply(this,o(arguments,2))},t[_]=i}return r.smixins&&f(t.prototype,r.smixins),l(t.prototype,e,t),t[v]=r.name,t.prototype[g]=t,t.prototype[E]=!0,t},n.$$={cls:function(n,t){return function(){var r=o(arguments);return r.unshift(n),t.apply(this,r)}},cached:function(n){var t=function(){return t._cache?t._cache:(t._cache=n.apply(this,arguments),t._cache)};return t._cache=null,t}},n}({});module&&(module.exports=Jassino);