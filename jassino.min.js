"use strict";var Jassino=function(n){function t(n){if(s(n)){var r="";for(var e in n)r+=e+"::"+t(n[e])+"\n";return r}return String(n)}function r(n){console.log(n);var t="\n";for(var r in n)t+=r+": "+String(n[r])+"\n";return t}function e(n){function e(e,o,s){this.message=(n?n+": ":"\n")+(o||"DATA:")+" ==> \n"+t(e)+"\n"+(s?r(s):"")}return e.prototype=new Error,e.prototype.constructor=e,e}function o(n,t,r){return Array.prototype.slice.call(n,t,r)}function s(n){return"[object Object]"===Object.prototype.toString.call(n)&&n}function i(n){return"[object Array]"===Object.prototype.toString.call(n)}function a(n){return n?n.split(/\s*,\s*/):[]}function c(n,t,r){if(n===t)throw Error("Recursive assignment destination[fieldName] = destination! \n"+JSON.stringify(n)+"\n   fieldName: "+r);n[r]=t}function u(n,t){for(var r in t)if(t.hasOwnProperty(r)){var e=t[r];if(n===e)throw Error("Recursive assignment destination[fieldName] = destination! \n"+JSON.stringify(n)+"\n   fieldName: "+r);n[r]=e}return n}function f(n,t){for(var r=0;r<t.length;r++)u(n,t[r])}function l(t,r,e){var o=r[w],s=r[y],i=r[d];if(o){if(typeof e!==C)throw new n.MembersError(r,"Mixin cannot have class (static) members");p(e[w],o,e)}o&&delete r[w],s&&delete r[y],i&&delete r[d],p(t,r,e),o&&(r[w]=o),s&&(r[y]=s),i&&(r[d]=i)}function p(t,r,e){for(var o in r)if(r.hasOwnProperty(o)){var s,a=r[o],u=null,f=n.$$;i(a)?(s=a[a.length-1],u=a.slice(0,a.length-1)):s=a,u&&(typeof s===C&&-1!==u.indexOf(f.clsArg)&&(s=f.clsArg(e,s)),-1!==u.indexOf(f.cached)&&(s=f.cached(s))),c(t,s,o)}}function h(t){var r,e=n.ArgumentsError,o=0,a=t.length;if(2>a)throw new e(t,"Specify at least name and body");if(s(t[0]))o++,r=t[0];else{if(!t[0]||typeof t[0]!==O)throw new e(t,"First argument should be namespace or name");r=n.NS||null}var c={body:t[a-1],ns:r,name:t[o],sclass:null,smixins:null},u=a-(o+1)-1;if(!c.name||typeof c.name!==O)throw new e(c,"Invalid name");if(u>0){var f=" -> Parameters SHOULD BE: ([namespace,] name, [class,] [mixins_array,] body)",l=t[o+1];if(2==u){var p=t[o+2];if(typeof l!==C||!i(p))throw new e(c,"Super mixins and/or super class are invalid:"+l+","+p+f);c.sclass=l,c.smixins=p}else{if(1!=u)throw new e(c,"too many parameters");if(typeof l===C)c.sclass=l;else{if(!i(l))throw new e(c,"Class or mixins array is invalid: "+l+f);c.smixins=l}}}return c}function m(t,r){if(t.ns){if(typeof t.ns[t.name]!==S)throw new n.DuplicationError(t);t.ns[t.name]=r}}var y="_",d="__",w="cls",g="__cls_proto",v="__name__",_="__child__",b="__super__",E="super",x="supercall";n.DuplicationError=e("Duplication"),n.ArgumentsError=e("Arguments"),n.ConstructorError=e("Constructor"),n.InstantiationError=e("Instantiation"),n.MembersError=e("Members"),n.useGlobalScope=function(t){var r=t||window;r.Class=n.Class,r.Mixin=n.Mixin,r.$$=n.$$,r.Jassino=n},n.setDefaultNS=function(n){return this.NS=n};var S="undefined",C="function",O="string";return n.Mixin=function(){var n=h(arguments),t={};if(m(n,t),n.smixins&&f(t,n.smixins),n.body[y])throw new AE(n,"Mixin should not contain the constructor!");return l(t,n.body),t},n.Class=function(){var t,r=h(arguments),e=r.body,s=r.sclass,i=e[y],c=e[d],u=function(){throw new n.InstantiationError({},'use "new": new ClassA()')};if(i&&"auto"!==i)if(typeof i===C)t=function A(){this[_]||u();try{var t=o(arguments);t.unshift(A),i.apply(this,t)}catch(r){throw new n.ConstructorError(r.message,"\n[Hint1: Recursive call by constructor to itself ??]\n[Hint2: Need Super call ??]\n",r)}finally{}};else{if(typeof i!==O)throw new n.ConstructorError(i,"Invalid constructor");var p=a(i);if(c){if(!(c>0))throw new n.ConstructorError(c,"Invalid number of the Super constructor arguments");if(!s)throw new n.ConstructorError(i,"__: '"+c+"' assumes SuperClass presence");t=function(){this[_]||u(),s.apply(this,o(arguments,0,c));for(var n=c;n<p.length;n++)this[p[n]]=arguments[n]}}else{if(s&&typeof c===S)throw new n.ConstructorError(i,"_: '"+i+"' -- Class and SuperClass shortcut notations must be present both!");t=function(){this[_]||u();for(var n=0;n<p.length;n++)this[p[n]]=arguments[n]}}}else t=s?function(){this[_]||u(),s.apply(this,arguments)}:function(){this[_]||u()};if(m(r,t),s){s[v];t.prototype=Object.create(s.prototype),t.prototype.constructor=t,t[w]=s[g]?Object.create(s[g]):{},t.prototype[E]||(t.prototype[E]=function(n){return n[b].apply(this,o(arguments,1))},t.prototype[x]=function(n,t){return n[b].prototype[t].apply(this,o(arguments,2))}),t[b]=s}else t[w]={};return r.smixins&&f(t.prototype,r.smixins),l(t.prototype,e,t),t[g]=Object.create(t[w]),t[w][_]=t,t[v]=r.name,t.prototype[_]=t,t},n.$$={clsArg:function(n,t){return function(){var r=o(arguments);return r.unshift(n),t.apply(this,r)}},cached:function(n){var t=function(){return t._cache?t._cache:(t._cache=n.apply(this,arguments),t._cache)};return t._cache=null,t}},n}({});module&&(module.exports=Jassino);